{"version":3,"file":"tinkoff-angular-contenteditable-accessor.js","sources":["ng:/@tinkoff/angular-contenteditable-accessor/lib/contenteditable-value-accessor.ts","ng:/@tinkoff/angular-contenteditable-accessor/lib/module.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    AfterViewInit,\n    Directive,\n    ElementRef,\n    forwardRef,\n    HostListener,\n    Inject,\n    OnDestroy,\n    Renderer2,\n} from '@angular/core';\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR} from '@angular/forms';\n\n/*\n * This is a barebones contenteditable {@link ControlValueAccessor} allowing you to use\n * Angular forms with native contenteditable HTML. For security reasons you might want\n * to consider sanitizing pasted/dropped content before using it. Also make sure that\n * you do not set any dangerous content as control value yourself, because directive\n * just outputs control value as-is.\n */\n@Directive({\n    selector:\n        '[contenteditable][formControlName], [contenteditable][formControl], [contenteditable][ngModel]',\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => ContenteditableValueAccessor),\n            multi: true,\n        },\n    ],\n})\nexport class ContenteditableValueAccessor\n    implements ControlValueAccessor, AfterViewInit, OnDestroy {\n    /*\n     * MutationObserver IE11 fallback (as opposed to input event for modern browsers).\n     * When mutation removes a tag, i.e. delete is pressed on the last remaining character\n     * inside a tag â callback is triggered before the DOM is actually changed, therefore\n     * setTimeout is used\n     */\n    private observer = new MutationObserver(() => {\n        setTimeout(() => {\n            this.onChange(\n                ContenteditableValueAccessor.processValue(\n                    this.elementRef.nativeElement.innerHTML,\n                ),\n            );\n        });\n    });\n\n    /*\n     * onTouch callback that marks control as touched and allows FormHooks use\n     */\n    private onTouched = () => {};\n\n    /*\n     * onChange callback that writes value to control and allows FormHooks use\n     */\n    private onChange: (value: string) => void = () => {};\n\n    constructor(\n        @Inject(ElementRef) private readonly elementRef: ElementRef,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n    ) {}\n\n    /*\n     * To support IE11 MutationObserver is used to monitor changes to the content\n     */\n    ngAfterViewInit() {\n        this.observer.observe(this.elementRef.nativeElement, {\n            characterData: true,\n            childList: true,\n            subtree: true,\n        });\n    }\n\n    /*\n     * Disconnect MutationObserver IE11 fallback on destroy\n     */\n    ngOnDestroy() {\n        this.observer.disconnect();\n    }\n\n    /*\n     * Listen to input events to write innerHTML value into control,\n     * also disconnect MutationObserver as it is not needed if this\n     * event works in current browser\n     */\n    @HostListener('input')\n    onInput() {\n        this.observer.disconnect();\n        this.onChange(\n            ContenteditableValueAccessor.processValue(\n                this.elementRef.nativeElement.innerHTML,\n            ),\n        );\n    }\n\n    /*\n     * Listen to blur event to mark control as touched\n     */\n    @HostListener('blur')\n    onBlur() {\n        this.onTouched();\n    }\n\n    /*\n     * Reacts to external change\n     *\n     * @see {@link ControlValueAccessor#writeValue}\n     */\n    writeValue(value: string | null) {\n        this.renderer.setProperty(\n            this.elementRef.nativeElement,\n            'innerHTML',\n            ContenteditableValueAccessor.processValue(value),\n        );\n    }\n\n    /*\n     * Registers onChange callback\n     *\n     * @see {@link ControlValueAccessor#registerOnChange}\n     */\n    registerOnChange(onChange: (value: string) => void) {\n        this.onChange = onChange;\n    }\n\n    /*\n     * Registers onTouch callback\n     *\n     * @see {@link ControlValueAccessor#registerOnTouched}\n     */\n    registerOnTouched(onTouched: () => void) {\n        this.onTouched = onTouched;\n    }\n\n    /*\n     * Sets disabled state by setting contenteditable attribute to true/false\n     *\n     * @see {@link ControlValueAccessor#setDisabledState}\n     */\n    setDisabledState(disabled: boolean) {\n        this.renderer.setAttribute(\n            this.elementRef.nativeElement,\n            'contenteditable',\n            String(!disabled),\n        );\n    }\n\n    /*\n     * null and other falsy control values are treated as empty string to\n     * prevent IE11 outputting 'null', also single <br> is replaced with empty\n     * string when passed to the control\n     */\n    private static processValue(value: string | null): string {\n        const processed = value || '';\n\n        return processed.trim() === '<br>' ? '' : processed;\n    }\n}\n","import {NgModule} from '@angular/core';\nimport {ContenteditableValueAccessor} from './contenteditable-value-accessor';\n\n@NgModule({\n    declarations: [ContenteditableValueAccessor],\n    exports: [ContenteditableValueAccessor],\n})\nexport class ContenteditableValueAccessorModule {}\n"]}