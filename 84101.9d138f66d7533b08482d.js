"use strict";(self.webpackChunk_taiga_ui_components=self.webpackChunk_taiga_ui_components||[]).push([[84101],{84101:(ni,ht,ue)=>{ue.r(ht),ue.d(ht,{Placeholder:()=>En,default:()=>En});var An=ue(40256),S=ue(35917),Ve=ue(38480);const Re=Object.create(null);class D{constructor(e,t,s){this.$anchor=e,this.$head=t,this.ranges=s||[new Pn(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=S.p2.empty){let s=t.content.lastChild,i=null;for(let l=0;l<t.openEnd;l++)i=s,s=s.lastChild;let r=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:a,$to:c}=o[l],d=e.mapping.slice(r);e.replaceRange(d.map(a.pos),d.map(c.pos),l?S.p2.empty:t),0==l&&pt(e,r,(s?s.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let s=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:o,$to:l}=i[r],a=e.mapping.slice(s),c=a.map(o.pos),d=a.map(l.pos);r?e.deleteRange(c,d):(e.replaceRangeWith(c,d,t),pt(e,s,t.isInline?-1:1))}}static findFrom(e,t,s=!1){let i=e.parent.inlineContent?new N(e):re(e.node(0),e.parent,e.pos,e.index(),t,s);if(i)return i;for(let r=e.depth-1;r>=0;r--){let o=t<0?re(e.node(0),e.node(r),e.before(r+1),e.index(r),t,s):re(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,s);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new z(e.node(0))}static atStart(e){return re(e,e,0,0,1)||new z(e)}static atEnd(e){return re(e,e,e.content.size,e.childCount,-1)||new z(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=Re[t.type];if(!s)throw new RangeError(`No selection type ${t.type} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in Re)throw new RangeError("Duplicate use of selection JSON ID "+e);return Re[e]=t,t.prototype.jsonID=e,t}getBookmark(){return N.between(this.$anchor,this.$head).getBookmark()}}D.prototype.visible=!0;class Pn{constructor(e,t){this.$from=e,this.$to=t}}let ft=!1;function ut(n){!ft&&!n.parent.inlineContent&&(ft=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class N extends D{constructor(e,t=e){ut(e),ut(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let s=e.resolve(t.map(this.head));if(!s.parent.inlineContent)return D.near(s);let i=e.resolve(t.map(this.anchor));return new N(i.parent.inlineContent?i:s,s)}replace(e,t=S.p2.empty){if(super.replace(e,t),t==S.p2.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof N&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Oe(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new N(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){let i=e.resolve(t);return new this(i,s==t?i:e.resolve(s))}static between(e,t,s){let i=e.pos-t.pos;if((!s||i)&&(s=i>=0?1:-1),!t.parent.inlineContent){let r=D.findFrom(t,s,!0)||D.findFrom(t,-s,!0);if(!r)return D.near(t,s);t=r.$head}return e.parent.inlineContent||(0==i||(e=(D.findFrom(e,-s,!0)||D.findFrom(e,s,!0)).$anchor).pos<t.pos!=i<0)&&(e=t),new N(e,t)}}D.jsonID("text",N);class Oe{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Oe(e.map(this.anchor),e.map(this.head))}resolve(e){return N.between(e.resolve(this.anchor),e.resolve(this.head))}}class y extends D{constructor(e){let t=e.nodeAfter,s=e.node(0).resolve(e.pos+t.nodeSize);super(e,s),this.node=t}map(e,t){let{deleted:s,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return s?D.near(r):new y(r)}content(){return new S.p2(S.HY.from(this.node),0,0)}eq(e){return e instanceof y&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ie(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new y(e.resolve(t.anchor))}static create(e,t){return new y(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}y.prototype.visible=!1,D.jsonID("node",y);class Ie{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:s}=e.mapResult(this.anchor);return t?new Oe(s,s):new Ie(s)}resolve(e){let t=e.resolve(this.anchor),s=t.nodeAfter;return s&&y.isSelectable(s)?new y(t):D.near(t)}}class z extends D{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=S.p2.empty){if(t==S.p2.empty){e.delete(0,e.doc.content.size);let s=D.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new z(e)}map(e){return new z(e)}eq(e){return e instanceof z}getBookmark(){return Vn}}D.jsonID("all",z);const Vn={map(){return this},resolve:n=>new z(n)};function re(n,e,t,s,i,r=!1){if(e.inlineContent)return N.create(n,t);for(let o=s-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let l=e.child(o);if(l.isAtom){if(!r&&y.isSelectable(l))return y.create(n,t-(i<0?l.nodeSize:0))}else{let a=re(n,l,t+i,i<0?l.childCount:0,i,r);if(a)return a}t+=l.nodeSize*i}return null}function pt(n,e,t){let s=n.steps.length-1;if(s<e)return;let o,i=n.steps[s];(i instanceof Ve.Pu||i instanceof Ve.FC)&&(n.mapping.maps[s].forEach((l,a,c,d)=>{null==o&&(o=d)}),n.setSelection(D.near(n.doc.resolve(o),t)))}function yt(n,e){return e&&n?n.bind(e):n}class pe{constructor(e,t,s){this.name=e,this.init=yt(t.init,s),this.apply=yt(t.apply,s)}}function bt(n,e,t){for(let s in n){let i=n[s];i instanceof Function?i=i.bind(e):"handleDOMEvents"==s&&(i=bt(i,e,{})),t[s]=i}return t}new pe("doc",{init:n=>n.doc||n.schema.topNodeType.createAndFill(),apply:n=>n.doc}),new pe("selection",{init:(n,e)=>n.selection||D.atStart(e.doc),apply:n=>n.selection}),new pe("storedMarks",{init:n=>n.storedMarks||null,apply:(n,e,t,s)=>s.selection.$cursor?n.storedMarks:null}),new pe("scrollToSelection",{init:()=>0,apply:(n,e)=>n.scrolledIntoView?e+1:e});class Bn{constructor(e){var n;this.spec=e,this.props={},e.props&&bt(e.props,this,this.props),this.key=e.key?e.key.key:(n="plugin")in Fe?n+"$"+ ++Fe[n]:(Fe[n]=0,n+"$")}getState(e){return e[this.key]}}const Fe=Object.create(null);const H="undefined"!=typeof navigator?navigator:null,Dt="undefined"!=typeof document?document:null,w=H&&H.userAgent||"",ze=/Edge\/(\d+)/.exec(w),Nt=/MSIE \d/.exec(w),Le=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(w),A=!!(Nt||Le||ze),J=Nt?document.documentMode:Le?+Le[1]:ze?+ze[1]:0,L=!A&&/gecko\/(\d+)/i.test(w);L&&/Firefox\/(\d+)/.exec(w);const $e=!A&&/Chrome\/(\d+)/.exec(w),M=!!$e,Fn=$e?+$e[1]:0,T=!A&&!!H&&/Apple Computer/.test(H.vendor),oe=T&&(/Mobile\/\w+/.test(w)||!!H&&H.maxTouchPoints>2),V=oe||!!H&&/Mac/.test(H.platform),$=/Android \d/.test(w),ke=!!Dt&&"webkitFontSmoothing"in Dt.documentElement.style,zn=ke?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,P=function(n){for(var e=0;;e++)if(!(n=n.previousSibling))return e},Ln=/^(img|br|input|textarea|hr)$/i;function Ct(n,e,t,s,i){for(;;){if(n==t&&e==s)return!0;if(e==(i<0?0:K(n))){let r=n.parentNode;if(!r||1!=r.nodeType||Kn(n)||Ln.test(n.nodeName)||"false"==n.contentEditable)return!1;e=P(n)+(i<0?0:1),n=r}else{if(1!=n.nodeType)return!1;if("false"==(n=n.childNodes[e+(i<0?-1:0)]).contentEditable)return!1;e=i<0?K(n):0}}}function K(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function Kn(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const We=function(n){let e=n.isCollapsed;return e&&M&&n.rangeCount&&!n.getRangeAt(0).collapsed&&(e=!1),e};function le(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}const Se=function(n){n&&(this.nodeName=n)};function wt(n){return n.editable?n.hasFocus():function(n){let e=n.domSelection();if(!e.anchorNode)return!1;try{return n.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(t){return!1}}(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function j(n,e=!1){let t=n.state.selection;if(function(n,e){if(e instanceof y){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Gt(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Gt(n)}(n,t),wt(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&M){let s=n.domSelection(),i=n.domObserver.currentSelection;if(s.anchorNode&&i.anchorNode&&function(n,e,t,s){return t&&(Ct(n,e,t,s,-1)||Ct(n,e,t,s,1))}(s.anchorNode,s.anchorOffset,i.anchorNode,i.anchorOffset))return n.input.mouseDown.delayedSelectionSync=!0,void n.domObserver.setCurSelection()}if(n.domObserver.disconnectSelection(),n.cursorWrapper)!function(n){let e=n.domSelection(),t=document.createRange(),s=n.cursorWrapper.dom,i="IMG"==s.nodeName;i?t.setEnd(s.parentNode,P(s)+1):t.setEnd(s,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&A&&J<=11&&(s.disabled=!0,s.disabled=!1)}(n);else{let r,o,{anchor:s,head:i}=t;Jt&&!(t instanceof N)&&(t.$from.parent.inlineContent||(r=Yt(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Yt(n,t.to))),n.docView.setSelection(s,i,n.root,e),Jt&&(r&&Ut(r),o&&Ut(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelection(),s=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=s||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!wt(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}Se.prototype=Object.create(null),new Se;const Jt=T||M&&Fn<63;function Yt(n,e){let{node:t,offset:s}=n.docView.domFromPos(e,0),i=s<t.childNodes.length?t.childNodes[s]:null,r=s?t.childNodes[s-1]:null;if(T&&i&&"false"==i.contentEditable)return Ue(i);if(!(i&&"false"!=i.contentEditable||r&&"false"!=r.contentEditable)){if(i)return Ue(i);if(r)return Ue(r)}}function Ue(n){return n.contentEditable="true",T&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Ut(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Gt(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function je(n,e,t,s){return n.someProp("createSelectionBetween",i=>i(n,e,t))||N.between(e,t,s)}function Ge(n,e){let{$anchor:t,$head:s}=n.selection,i=e>0?t.max(s):t.min(s),r=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return r&&D.findFrom(r,e)}function ee(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Zt(n,e,t){let s=n.state.selection;if(!(s instanceof N)){if(s instanceof y&&s.node.isInline)return ee(n,new N(e>0?s.$to:s.$from));{let i=Ge(n.state,e);return!!i&&ee(n,i)}}if(!s.empty||t.indexOf("s")>-1)return!1;if(n.endOfTextblock(e>0?"right":"left")){let i=Ge(n.state,e);return!!(i&&i instanceof y)&&ee(n,i)}if(!(V&&t.indexOf("m")>-1)){let o,i=s.$head,r=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!r||r.isText)return!1;let l=e<0?i.pos-r.nodeSize:i.pos;return!!(r.isAtom||(o=n.docView.descAt(l))&&!o.contentDOM)&&(y.isSelectable(r)?ee(n,new y(e<0?n.state.doc.resolve(i.pos-r.nodeSize):i)):!!ke&&ee(n,new N(n.state.doc.resolve(e<0?l:l+r.nodeSize))))}}function xe(n){return 3==n.nodeType?n.nodeValue.length:n.childNodes.length}function De(n){let e=n.pmViewDesc;return e&&0==e.size&&(n.nextSibling||"BR"!=n.nodeName)}function Xe(n){let e=n.domSelection(),t=e.focusNode,s=e.focusOffset;if(!t)return;let i,r,o=!1;for(L&&1==t.nodeType&&s<xe(t)&&De(t.childNodes[s])&&(o=!0);;)if(s>0){if(1!=t.nodeType)break;{let l=t.childNodes[s-1];if(De(l))i=t,r=--s;else{if(3!=l.nodeType)break;t=l,s=t.nodeValue.length}}}else{if(_t(t))break;{let l=t.previousSibling;for(;l&&De(l);)i=t.parentNode,r=P(l),l=l.previousSibling;if(l)t=l,s=xe(t);else{if(t=t.parentNode,t==n.dom)break;s=0}}}o?Ze(n,e,t,s):i&&Ze(n,e,i,r)}function Qe(n){let e=n.domSelection(),t=e.focusNode,s=e.focusOffset;if(!t)return;let r,o,i=xe(t);for(;;)if(s<i){if(1!=t.nodeType)break;if(!De(t.childNodes[s]))break;r=t,o=++s}else{if(_t(t))break;{let l=t.nextSibling;for(;l&&De(l);)r=l.parentNode,o=P(l)+1,l=l.nextSibling;if(l)t=l,s=0,i=xe(t);else{if(t=t.parentNode,t==n.dom)break;s=i=0}}}r&&Ze(n,e,r,o)}function _t(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ze(n,e,t,s){if(We(e)){let r=document.createRange();r.setEnd(t,s),r.setStart(t,s),e.removeAllRanges(),e.addRange(r)}else e.extend&&e.extend(t,s);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&j(n)},50)}function vt(n,e,t){let s=n.state.selection;if(s instanceof N&&!s.empty||t.indexOf("s")>-1||V&&t.indexOf("m")>-1)return!1;let{$from:i,$to:r}=s;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=Ge(n.state,e);if(o&&o instanceof y)return ee(n,o)}if(!i.parent.inlineContent){let o=e<0?i:r,l=s instanceof z?D.near(o,e):D.findFrom(o,e);return!!l&&ee(n,l)}return!1}function en(n,e){if(!(n.state.selection instanceof N))return!0;let{$head:t,$anchor:s,empty:i}=n.state.selection;if(!t.sameParent(s))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let r=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(r&&!r.isText){let o=n.state.tr;return e<0?o.delete(t.pos-r.nodeSize,t.pos):o.delete(t.pos,t.pos+r.nodeSize),n.dispatch(o),!0}return!1}function tn(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function nn(n,e){let t=[],{content:s,openStart:i,openEnd:r}=e;for(;i>1&&r>1&&1==s.childCount&&1==s.firstChild.childCount;){i--,r--;let h=s.firstChild;t.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),s=h.content}let o=n.someProp("clipboardSerializer")||S.PW.fromSchema(n.state.schema),l=hn(),a=l.createElement("div");a.appendChild(o.serializeFragment(s,{document:l}));let d,c=a.firstChild,u=0;for(;c&&1==c.nodeType&&(d=cn[c.nodeName.toLowerCase()]);){for(let h=d.length-1;h>=0;h--){let p=l.createElement(d[h]);for(;a.firstChild;)p.appendChild(a.firstChild);a.appendChild(p),u++}c=a.firstChild}return c&&1==c.nodeType&&c.setAttribute("data-pm-slice",`${i} ${r}${u?` -${u}`:""} ${JSON.stringify(t)}`),{dom:a,text:n.someProp("clipboardTextSerializer",h=>h(e))||e.content.textBetween(0,e.content.size,"\n\n")}}function sn(n,e,t,s,i){let o,l,r=i.parent.type.spec.code;if(!t&&!e)return null;let a=e&&(s||r||!t);if(a){if(n.someProp("transformPastedText",f=>{e=f(e,r||s)}),r)return e?new S.p2(S.HY.from(n.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):S.p2.empty;let u=n.someProp("clipboardTextParser",f=>f(e,i,s));if(u)l=u;else{let f=i.marks(),{schema:h}=n.state,p=S.PW.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let b=o.appendChild(document.createElement("p"));m&&b.appendChild(p.serializeNode(h.text(m,f)))})}}else n.someProp("transformPastedHTML",u=>{t=u(t)}),o=function(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let i,t=hn().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(n);if((i=s&&cn[s[1].toLowerCase()])&&(n=i.map(r=>"<"+r+">").join("")+n+i.map(r=>"</"+r+">").reverse().join("")),t.innerHTML=n,i)for(let r=0;r<i.length;r++)t=t.querySelector(i[r])||t;return t}(t),ke&&function(n){let e=n.querySelectorAll(M?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let s=e[t];1==s.childNodes.length&&"\xa0"==s.textContent&&s.parentNode&&s.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),s)}}(o);let c=o&&o.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0&&o.firstChild;u--)o=o.firstChild;if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||S.aw.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!(!a&&!d),context:i,ruleFromNode:f=>"BR"!=f.nodeName||f.nextSibling||!f.parentNode||ys.test(f.parentNode.nodeName)?null:{ignore:!0}})),d)l=function(n,e){if(!n.size)return n;let s,t=n.content.firstChild.type.schema;try{s=JSON.parse(e)}catch(l){return n}let{content:i,openStart:r,openEnd:o}=n;for(let l=s.length-2;l>=0;l-=2){let a=t.nodes[s[l]];if(!a||a.hasRequiredAttrs())break;i=S.HY.from(a.create(s[l+1],i)),r++,o++}return new S.p2(i,r,o)}(an(l,+d[1],+d[2]),d[4]);else if(l=S.p2.maxOpen(function(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let r,i=e.node(t).contentMatchAt(e.index(t)),o=[];if(n.forEach(l=>{if(!o)return;let c,a=i.findWrapping(l.type);if(!a)return o=null;if(c=o.length&&r.length&&on(a,r,l,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=ln(o[o.length-1],r.length));let d=rn(l,a);o.push(d),i=i.matchType(d.type),r=a}}),o)return S.HY.from(o)}return n}(l.content,i),!0),l.openStart||l.openEnd){let u=0,f=0;for(let h=l.content.firstChild;u<l.openStart&&!h.type.spec.isolating;u++,h=h.firstChild);for(let h=l.content.lastChild;f<l.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);l=an(l,u,f)}return n.someProp("transformPasted",u=>{l=u(l)}),l}const ys=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function rn(n,e,t=0){for(let s=e.length-1;s>=t;s--)n=e[s].create(null,S.HY.from(n));return n}function on(n,e,t,s,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let r=on(n,e,t,s.lastChild,i+1);if(r)return s.copy(s.content.replaceChild(s.childCount-1,r));if(s.contentMatchAt(s.childCount).matchType(i==n.length-1?t.type:n[i+1]))return s.copy(s.content.append(S.HY.from(rn(t,n,i+1))))}}function ln(n,e){if(0==e)return n;let t=n.content.replaceChild(n.childCount-1,ln(n.lastChild,e-1)),s=n.contentMatchAt(n.childCount).fillBefore(S.HY.empty,!0);return n.copy(t.append(s))}function _e(n,e,t,s,i,r){let o=e<0?n.firstChild:n.lastChild,l=o.content;return i<s-1&&(l=_e(l,e,t,s,i+1,r)),i>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,n.childCount>1||r<=i).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(S.HY.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(l))}function an(n,e,t){return e<n.openStart&&(n=new S.p2(_e(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new S.p2(_e(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const cn={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let dn=null;function hn(){return dn||(dn=document.implementation.createHTMLDocument("title"))}const E={};let x={};function te(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function Te(n){return{left:n.clientX,top:n.clientY}}function tt(n,e,t,s,i){if(-1==s)return!1;let r=n.state.doc.resolve(s);for(let o=r.depth+1;o>0;o--)if(n.someProp(e,l=>o>r.depth?l(n,t,r.nodeAfter,r.before(o),i,!0):l(n,t,r.node(o),r.before(o),i,!1)))return!0;return!1}function de(n,e,t){n.focused||n.focus();let s=n.state.tr.setSelection(e);"pointer"==t&&s.setMeta("pointer",!0),n.dispatch(s)}function Vs(n,e,t,s){return tt(n,"handleDoubleClickOn",e,t,s)||n.someProp("handleDoubleClick",i=>i(n,e,s))}function Rs(n,e,t,s){return tt(n,"handleTripleClickOn",e,t,s)||n.someProp("handleTripleClick",i=>i(n,e,s))||function(n,e,t){if(0!=t.button)return!1;let s=n.state.doc;if(-1==e)return!!s.inlineContent&&(de(n,N.create(s,0,s.content.size),"pointer"),!0);let i=s.resolve(e);for(let r=i.depth+1;r>0;r--){let o=r>i.depth?i.nodeAfter:i.node(r),l=i.before(r);if(o.inlineContent)de(n,N.create(s,l+1,l+1+o.content.size),"pointer");else{if(!y.isSelectable(o))continue;de(n,y.create(s,l),"pointer")}return!0}}(n,t,s)}function nt(n){return Ee(n)}x.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=16==t.keyCode||t.shiftKey,!un(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!$||!M||13!=t.keyCode))if(229!=t.keyCode&&n.domObserver.forceFlush(),!oe||13!=t.keyCode||t.ctrlKey||t.altKey||t.metaKey)n.someProp("handleKeyDown",s=>s(n,t))||function(n,e){let t=e.keyCode,s=function(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}(e);return 8==t||V&&72==t&&"c"==s?en(n,-1)||Xe(n):46==t||V&&68==t&&"c"==s?en(n,1)||Qe(n):13==t||27==t||(37==t||V&&66==t&&"c"==s?Zt(n,-1,s)||Xe(n):39==t||V&&70==t&&"c"==s?Zt(n,1,s)||Qe(n):38==t||V&&80==t&&"c"==s?vt(n,-1,s)||Xe(n):40==t||V&&78==t&&"c"==s?function(n){if(!T||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelection();if(e&&1==e.nodeType&&0==t&&e.firstChild&&"false"==e.firstChild.contentEditable){let s=e.firstChild;tn(n,s,"true"),setTimeout(()=>tn(n,s,"false"),20)}return!1}(n)||vt(n,1,s)||Qe(n):s==(V?"m":"c")&&(66==t||73==t||89==t||90==t))}(n,t)?t.preventDefault():te(n,"key");else{let s=Date.now();n.input.lastIOSEnter=s,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==s&&(n.someProp("handleKeyDown",i=>i(n,le(13,"Enter"))),n.input.lastIOSEnter=0)},200)}},x.keyup=(n,e)=>{16==e.keyCode&&(n.input.shiftKey=!1)},x.keypress=(n,e)=>{let t=e;if(un(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||V&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t)))return void t.preventDefault();let s=n.state.selection;if(!(s instanceof N&&s.$from.sameParent(s.$to))){let i=String.fromCharCode(t.charCode);n.someProp("handleTextInput",r=>r(n,s.$from.pos,s.$to.pos,i))||n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};const fn=V?"metaKey":"ctrlKey";E.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let s=nt(n),i=Date.now(),r="singleClick";i-n.input.lastClick.time<500&&function(n,e){let t=e.x-n.clientX,s=e.y-n.clientY;return t*t+s*s<100}(t,n.input.lastClick)&&!t[fn]&&("singleClick"==n.input.lastClick.type?r="doubleClick":"doubleClick"==n.input.lastClick.type&&(r="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:r};let o=n.posAtCoords(Te(t));!o||("singleClick"==r?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new Bs(n,o,t,!!s)):("doubleClick"==r?Vs:Rs)(n,o.pos,o.inside,t)?t.preventDefault():te(n,"pointer"))};class Bs{constructor(e,t,s,i){let r,o;if(this.view=e,this.pos=t,this.event=s,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[fn],this.allowDefault=s.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),o=t.inside;else{let d=e.state.doc.resolve(t.pos);r=d.parent,o=d.depth?d.before():0}const l=i?null:s.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:c}=e.state;(0==s.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||c instanceof y&&c.from<=o&&c.to>o)&&(this.mightDrag={node:r,pos:o,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!L||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),te(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>j(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Te(e))),this.allowDefault||!t?te(this.view,"pointer"):function(n,e,t,s,i){return tt(n,"handleClickOn",e,t,s)||n.someProp("handleClick",r=>r(n,e,s))||(i?function(n,e){if(-1==e)return!1;let s,i,t=n.state.selection;t instanceof y&&(s=t.node);let r=n.state.doc.resolve(e);for(let o=r.depth+1;o>0;o--){let l=o>r.depth?r.nodeAfter:r.node(o);if(y.isSelectable(l)){i=s&&t.$from.depth>0&&o>=t.$from.depth&&r.before(t.$from.depth+1)==t.$from.pos?r.before(t.$from.depth):r.before(o);break}}return null!=i&&(de(n,y.create(n.state.doc,i),"pointer"),!0)}(n,t):function(n,e){if(-1==e)return!1;let t=n.state.doc.resolve(e),s=t.nodeAfter;return!!(s&&s.isAtom&&y.isSelectable(s))&&(de(n,new y(t),"pointer"),!0)}(n,t))}(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||T&&this.mightDrag&&!this.mightDrag.node.isAtom||M&&!(this.view.state.selection instanceof N)&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(de(this.view,D.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):te(this.view,"pointer")}move(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),te(this.view,"pointer"),0==e.buttons&&this.done()}}function un(n,e){return!!n.composing||!!(T&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500)&&(n.input.compositionEndedAt=-2e8,!0)}E.touchdown=n=>{nt(n),te(n,"pointer")},E.contextmenu=n=>nt(n);const Fs=$?5e3:-1;function pn(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Ee(n),e))}function Ee(n,e=!1){if(!($&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),function(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=function(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}(n),e||n.docView&&n.docView.dirty){let t=function(n,e=null){let t=n.domSelection(),s=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),r=i&&0==i.size,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a,c,l=s.resolve(o);if(We(t)){for(a=l;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&y.isSelectable(d)&&i.parent&&(!d.isInline||!function(n,e,t){for(let s=0==e,i=e==K(n);s||i;){if(n==t)return!0;let r=P(n);if(!(n=n.parentNode))return!1;s=s&&0==r,i=i&&r==K(n)}}(t.focusNode,t.focusOffset,i.dom))){let u=i.posBefore;c=new y(o==u?l:s.resolve(u))}}else{let d=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(d<0)return null;a=s.resolve(d)}return c||(c=je(n,a,l,"pointer"==e||n.state.selection.head<l.pos&&!r?1:-1)),c}(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}}x.compositionstart=x.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(s=>!1===s.type.spec.inclusive)))n.markCursor=n.state.storedMarks||t.marks(),Ee(n,!0),n.markCursor=null;else if(Ee(n),L&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let s=n.domSelection();for(let i=s.focusNode,r=s.focusOffset;i&&1==i.nodeType&&0!=r;){let o=r<0?i.lastChild:i.childNodes[r-1];if(!o)break;if(3==o.nodeType){s.collapse(o,o.nodeValue.length);break}i=o,r=-1}}n.input.composing=!0}pn(n,Fs)},x.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,pn(n,20))};const he=A&&J<15||oe&&zn<604;function st(n,e,t,s){let i=sn(n,e,t,n.input.shiftKey,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,s,i||S.p2.empty)))return!0;if(!i)return!1;let r=function(n){return 0==n.openStart&&0==n.openEnd&&1==n.content.childCount?n.content.firstChild:null}(i),o=r?n.state.tr.replaceSelectionWith(r,n.input.shiftKey):n.state.tr.replaceSelection(i);return n.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}E.copy=x.cut=(n,e)=>{let t=e,s=n.state.selection,i="cut"==t.type;if(s.empty)return;let r=he?null:t.clipboardData,o=s.content(),{dom:l,text:a}=nn(n,o);r?(t.preventDefault(),r.clearData(),r.setData("text/html",l.innerHTML),r.setData("text/plain",a)):function(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),s.removeAllRanges(),s.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}(n,l),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},x.paste=(n,e)=>{let t=e;if(n.composing&&!$)return;let s=he?null:t.clipboardData;s&&st(n,s.getData("text/plain"),s.getData("text/html"),t)?t.preventDefault():function(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,s=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus(),setTimeout(()=>{n.focus(),s.parentNode&&s.parentNode.removeChild(s),t?st(n,s.value,null,e):st(n,s.textContent,s.innerHTML,e)},50)}(n,t)};class Ws{constructor(e,t){this.slice=e,this.move=t}}const gn=V?"altKey":"ctrlKey";E.dragstart=(n,e)=>{let t=e,s=n.input.mouseDown;if(s&&s.done(),!t.dataTransfer)return;let i=n.state.selection,r=i.empty?null:n.posAtCoords(Te(t));if(!(r&&r.pos>=i.from&&r.pos<=(i instanceof y?i.to-1:i.to)))if(s&&s.mightDrag)n.dispatch(n.state.tr.setSelection(y.create(n.state.doc,s.mightDrag.pos)));else if(t.target&&1==t.target.nodeType){let c=n.docView.nearestDesc(t.target,!0);c&&c.node.type.spec.draggable&&c!=n.docView&&n.dispatch(n.state.tr.setSelection(y.create(n.state.doc,c.posBefore)))}let o=n.state.selection.content(),{dom:l,text:a}=nn(n,o);t.dataTransfer.clearData(),t.dataTransfer.setData(he?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",he||t.dataTransfer.setData("text/plain",a),n.dragging=new Ws(o,!t[gn])},E.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)},x.dragover=x.dragenter=(n,e)=>e.preventDefault(),x.drop=(n,e)=>{let t=e,s=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(Te(t));if(!i)return;let r=n.state.doc.resolve(i.pos);if(!r)return;let o=s&&s.slice;o?n.someProp("transformPasted",p=>{o=p(o)}):o=sn(n,t.dataTransfer.getData(he?"Text":"text/plain"),he?null:t.dataTransfer.getData("text/html"),!1,r);let l=!(!s||t[gn]);if(n.someProp("handleDrop",p=>p(n,t,o||S.p2.empty,l)))return void t.preventDefault();if(!o)return;t.preventDefault();let a=o?(0,Ve.nj)(n.state.doc,r.pos,o):r.pos;null==a&&(a=r.pos);let c=n.state.tr;l&&c.deleteSelection();let d=c.mapping.map(a),u=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,f=c.doc;if(u?c.replaceRangeWith(d,d,o.content.firstChild):c.replaceRange(d,d,o),c.doc.eq(f))return;let h=c.doc.resolve(d);if(u&&y.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new y(h));else{let p=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((m,b,O,F)=>p=F),c.setSelection(je(n,h,c.doc.resolve(p)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))},E.focus=n=>{n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelection())&&j(n)},20))},E.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)},E.beforeinput=(n,e)=>{if(M&&$&&"deleteContentBackward"==e.inputType){n.domObserver.flushSoon();let{domChangeCount:s}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=s||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",r=>r(n,le(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in x)E[n]=x[n];function Ne(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class it{constructor(e,t){this.toDOM=e,this.spec=t||ne,this.side=this.spec.side||0}map(e,t,s,i){let{pos:r,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new R(r-s,r-s,this)}valid(){return!0}eq(e){return this==e||e instanceof it&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ne(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class G{constructor(e,t){this.attrs=e,this.spec=t||ne}map(e,t,s,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-s,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-s;return r>=o?null:new R(r,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof G&&Ne(this.attrs,e.attrs)&&Ne(this.spec,e.spec)}static is(e){return e.type instanceof G}destroy(){}}class rt{constructor(e,t){this.attrs=e,this.spec=t||ne}map(e,t,s,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=r.pos?null:new R(r.pos-s,o.pos-s,this)}valid(e,t){let r,{index:s,offset:i}=e.content.findIndex(t.from);return i==t.from&&!(r=e.child(s)).isText&&i+r.nodeSize==t.to}eq(e){return this==e||e instanceof rt&&Ne(this.attrs,e.attrs)&&Ne(this.spec,e.spec)}destroy(){}}class R{constructor(e,t,s){this.from=e,this.to=t,this.type=s}copy(e,t){return new R(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,s){return this.type.map(e,this,t,s)}static widget(e,t,s){return new R(e,e,new it(t,s))}static inline(e,t,s,i){return new R(e,t,new G(s,i))}static node(e,t,s,i){return new R(e,t,new rt(s,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof G}}const fe=[],ne={};class C{constructor(e,t){this.local=e.length?e:fe,this.children=t.length?t:fe}static create(e,t){return t.length?Ae(t,e,0,ne):k}find(e,t,s){let i=[];return this.findInner(null==e?0:e,null==t?1e9:t,i,0,s),i}findInner(e,t,s,i,r){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!r||r(l.spec))&&s.push(l.copy(l.from+i,l.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,s,i+l,r)}}map(e,t,s){return this==k||0==e.maps.length?this:this.mapInner(e,t,0,0,s||ne)}mapInner(e,t,s,i,r){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,s,i);a&&a.type.valid(t,a)?(o||(o=[])).push(a):r.onRemove&&r.onRemove(this.local[l].spec)}return this.children.length?function(n,e,t,s,i,r,o){let l=n.slice(),a=(d,u,f,h)=>{for(let p=0;p<l.length;p+=3){let b,m=l[p+1];if(m<0||d>m+r)continue;let O=l[p]+r;u>=O?l[p+1]=d<=O?-2:-1:f>=i&&(b=h-f-(u-d))&&(l[p]+=b,l[p+1]+=b)}};for(let d=0;d<t.maps.length;d++)t.maps[d].forEach(a);let c=!1;for(let d=0;d<l.length;d+=3)if(l[d+1]<0){if(-2==l[d+1]){c=!0,l[d+1]=-1;continue}let u=t.map(n[d]+r),f=u-i;if(f<0||f>=s.content.size){c=!0;continue}let p=t.map(n[d+1]+r,-1)-i,{index:m,offset:b}=s.content.findIndex(f),O=s.maybeChild(m);if(O&&b==f&&b+O.nodeSize==p){let F=l[d+2].mapInner(t,O,u+1,n[d]+r+1,o);F!=k?(l[d]=f,l[d+1]=p,l[d+2]=F):(l[d+1]=-2,c=!0)}else c=!0}if(c){let d=function(n,e,t,s,i,r,o){function l(a,c){for(let d=0;d<a.local.length;d++){let u=a.local[d].map(s,i,c);u?t.push(u):o.onRemove&&o.onRemove(a.local[d].spec)}for(let d=0;d<a.children.length;d+=3)l(a.children[d+2],a.children[d]+c+1)}for(let a=0;a<n.length;a+=3)-1==n[a+1]&&l(n[a+2],e[a]+r+1);return t}(l,n,e,t,i,r,o),u=Ae(d,s,0,o);e=u.local;for(let f=0;f<l.length;f+=3)l[f+1]<0&&(l.splice(f,3),f-=3);for(let f=0,h=0;f<u.children.length;f+=3){let p=u.children[f];for(;h<l.length&&l[h]<p;)h+=3;l.splice(h,0,u.children[f],u.children[f+1],u.children[f+2])}}return new C(e.sort(se),l)}(this.children,o||[],e,t,s,i,r):o?new C(o.sort(se),fe):k}add(e,t){return t.length?this==k?C.create(e,t):this.addInner(e,t,0):this}addInner(e,t,s){let i,r=0;e.forEach((l,a)=>{let d,c=a+s;if(d=bn(t,l,c)){for(i||(i=this.children.slice());r<i.length&&i[r]<a;)r+=3;i[r]==a?i[r+2]=i[r+2].addInner(l,d,c+1):i.splice(r,0,a,a+l.nodeSize,Ae(d,l,c+1,ne)),r+=3}});let o=yn(r?Sn(t):t,-s);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new C(o.length?this.local.concat(o).sort(se):this.local,i||this.children)}remove(e){return 0==e.length||this==k?this:this.removeInner(e,0)}removeInner(e,t){let s=this.children,i=this.local;for(let r=0;r<s.length;r+=3){let o,l=s[r]+t,a=s[r+1]+t;for(let u,d=0;d<e.length;d++)(u=e[d])&&u.from>l&&u.to<a&&(e[d]=null,(o||(o=[])).push(u));if(!o)continue;s==this.children&&(s=this.children.slice());let c=s[r+2].removeInner(o,l+1);c!=k?s[r+2]=c:(s.splice(r,3),r-=3)}if(i.length)for(let o,r=0;r<e.length;r++)if(o=e[r])for(let l=0;l<i.length;l++)i[l].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1));return s==this.children&&i==this.local?this:i.length||s.length?new C(i,s):k}forChild(e,t){if(this==k)return this;if(t.isLeaf)return C.empty;let s,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(s=this.children[l+2]);break}let r=e+1,o=r+t.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>r&&a.type instanceof G){let c=Math.max(r,a.from)-r,d=Math.min(o,a.to)-r;c<d&&(i||(i=[])).push(a.copy(c,d))}}if(i){let l=new C(i.sort(se),fe);return s?new X([l,s]):l}return s||k}eq(e){if(this==e)return!0;if(!(e instanceof C)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return ot(this.localsInner(e))}localsInner(e){if(this==k)return fe;if(e.inlineContent||!this.local.some(G.is))return this.local;let t=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof G||t.push(this.local[s]);return t}}C.empty=new C([],[]),C.removeOverlap=ot;const k=C.empty;class X{constructor(e){this.members=e}map(e,t){const s=this.members.map(i=>i.map(e,t,ne));return X.from(s)}forChild(e,t){if(t.isLeaf)return C.empty;let s=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=k&&(r instanceof X?s=s.concat(r.members):s.push(r))}return X.from(s)}eq(e){if(!(e instanceof X)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,s=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(t){s&&(t=t.slice(),s=!1);for(let o=0;o<r.length;o++)t.push(r[o])}else t=r}return t?ot(s?t:t.sort(se)):fe}static from(e){switch(e.length){case 0:return k;case 1:return e[0];default:return new X(e)}}}function yn(n,e){if(!e||!n.length)return n;let t=[];for(let s=0;s<n.length;s++){let i=n[s];t.push(new R(i.from+e,i.to+e,i.type))}return t}function bn(n,e,t){if(e.isLeaf)return null;let s=t+e.nodeSize,i=null;for(let o,r=0;r<n.length;r++)(o=n[r])&&o.from>t&&o.to<s&&((i||(i=[])).push(o),n[r]=null);return i}function Sn(n){let e=[];for(let t=0;t<n.length;t++)null!=n[t]&&e.push(n[t]);return e}function Ae(n,e,t,s){let i=[],r=!1;e.forEach((l,a)=>{let c=bn(n,l,a+t);if(c){r=!0;let d=Ae(c,l,t+a+1,s);d!=k&&i.push(a,a+l.nodeSize,d)}});let o=yn(r?Sn(n):n,-t).sort(se);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(s.onRemove&&s.onRemove(o[l].spec),o.splice(l--,1));return o.length||i.length?new C(o,i):k}function se(n,e){return n.from-e.from||n.to-e.to}function ot(n){let e=n;for(let t=0;t<e.length-1;t++){let s=e[t];if(s.from!=s.to)for(let i=t+1;i<e.length;i++){let r=e[i];if(r.from!=s.from){r.from<s.to&&(e==n&&(e=n.slice()),e[t]=s.copy(s.from,r.from),Dn(e,i,s.copy(r.from,s.to)));break}r.to!=s.to&&(e==n&&(e=n.slice()),e[i]=r.copy(r.from,s.to),Dn(e,i+1,r.copy(s.to,r.to)))}}return e}function Dn(n,e,t){for(;e<n.length&&se(t,n[e])>0;)e++;n.splice(e,0,t)}const En=An.Extension.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something \u2026",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new Bn({props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,i=[];return t?(n.descendants((r,o)=>{const l=s>=o&&s<=o+r.nodeSize;if((l||!this.options.showOnlyCurrent)&&!r.isLeaf&&!r.childCount){const c=[this.options.emptyNodeClass];this.editor.isEmpty&&c.push(this.options.emptyEditorClass);const d=R.node(o,o+r.nodeSize,{class:c.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:r,pos:o,hasAnchor:l}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),C.create(n,i)):null}}})]}})}}]);